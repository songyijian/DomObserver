{"version":3,"file":"DomObserver.js","sources":["../src/index.js"],"sourcesContent":["'use strict';\n\nfunction type(o) {\n  return Object.prototype.toString.call(o).slice(8, -1)\n}\n\nclass DomObserver {\n  constructor( dom = document, config = {} ) {\n    this.MutationObserver = window.MutationObserver || window.WebKitMutationObserver || window.MozMutationObserver;\n    var isSupport = !!MutationObserver;\n    if (!isSupport) {\n      console.error('Browser does not support')\n      return undefined\n    }\n\n    this.dom = dom\n    this.config = {}\n    var defaultConfig = {\n      attributes: true, \n      attributeOldValue:true,\n      childList: true,\n      subtree:true,\n      characterData: true,\n    }\n    Object.assign(this.config, defaultConfig, DomObserver.config, config)\n    this.observerObj =  this.created()\n    this.observe()\n\n    this.onChildList = function(){}\n    this.onAddChildList = function(){}\n    this.onRmChildList = function(){}\n    this.onAttributes = function(){}\n    this.onChange = function(){}\n  }\n\n  created() {\n    var MutationObserver = this.MutationObserver;\n    return new MutationObserver((mutations, instance) => {\n      mutations.forEach((mitem) => {\n        \n        if (mitem.type === 'childList') {\n          let rmlist = mitem.removedNodes\n          let addlist = mitem.addedNodes\n\n          // addedNodes\n          if (addlist.length > 0) {\n            let atf = this.config.addTagFilter\n            if(type(atf)==='Array'){ \n              let addlock = false\n              for (let c = 0; c < rmlist.length; c++) {\n                let n = rmlist[c];\n                let tn = n.nodeName.toLowerCase()\n                if(atf.indexOf(tn)>=0){\n                  addlock = true\n                  break\n                }\n              }\n              if(addlock){\n                this.childList(mitem)\n                this.onAddChildList(mitem)\n              }\n            }else{\n              this.childList(mitem)\n              this.onAddChildList(mitem)\n            }\n          }\n\n          // removedNodes\n          if (rmlist.length > 0) {\n            let rtf = this.config.rmTagFilter\n            let rnf = this.config.rmNodesFilter\n            if(type(rtf)==='Array' || type(rnf)==='Array'){ \n              let rmlock = false\n              for (let c = 0; c < rmlist.length; c++) {\n                let n = rmlist[c];\n                let tn = n.nodeName.toLowerCase()\n                if(type(rtf)==='Array' && rtf.indexOf(tn)>=0){\n                  rmlock = true\n                  break\n                }else if(type(rnf)==='Array'){\n                  for (let e = 0; e < rnf.length; e++) {\n                    if(rnf[e] === n){\n                      rmlock = true\n                      break\n                    }\n                  }\n                  if(rmlock)break\n                }\n              }\n              if(rmlock){\n                this.childList(mitem)\n                this.onRmChildList(mitem)\n              }\n            }else{\n              this.childList(mitem)\n              this.onRmChildList(mitem)\n            }\n          }\n        }\n\n        // attributes\n        if (mitem.type === 'attributes') {\n          let tag = mitem.target.nodeName.toLowerCase()\n          let atf = this.config.attrTagFilter\n          let key = mitem.attributeName; \n          let val = mitem.target.getAttribute(key);\n\n          if(!atf || type(atf) ==='undefined' || type(atf)!=='Array' ){ \n            this.onAttributes(mitem, key, val )\n            return this\n          }\n          if(atf.indexOf(tag) >= 0){\n            this.onAttributes(mitem, key, val )\n          }\n          \n        }\n\n      })\n    })\n    //.observe(this.dom, self.config)\n  }\n\n  observe() {\n    this.observerObj && this.observerObj.observe(this.dom, this.config);\n    return this\n  }\n\n  disconnect() {\n    this.observerObj && this.observerObj.disconnect();\n    return this\n  }\n\n  /////////////////////////////////\n  // 注册监听\n  childList(fn) {\n    typeof fn === 'function' &&  (this.onChildList = fn)\n    return this\n  }\n  addChildList(fn) {\n    typeof fn === 'function' &&  (this.onAddChildList = fn)\n    return this\n  }\n  rmChildList(fn) {\n    typeof fn === 'function' &&  (this.onRmChildList = fn)\n    return this\n  }\n  attributes(fn) {\n    typeof fn === 'function' &&  (this.onAttributes = fn)\n    return this\n  }\n  change(){\n    typeof fn === 'function' &&  (this.onChange = fn)\n    return this\n  }\n\n}\n\nDomObserver.config = {}\n\nwindow.DomObserver = DomObserver\n\n\n"],"names":["type","o","Object","prototype","toString","call","slice","DomObserver","dom","document","config","MutationObserver","window","WebKitMutationObserver","MozMutationObserver","isSupport","console","error","undefined","defaultConfig","attributes","attributeOldValue","childList","subtree","characterData","assign","observerObj","created","observe","onChildList","onAddChildList","onRmChildList","onAttributes","onChange","mutations","instance","forEach","mitem","rmlist","removedNodes","addlist","addedNodes","length","atf","addTagFilter","addlock","c","n","tn","nodeName","toLowerCase","indexOf","rtf","rmTagFilter","rnf","rmNodesFilter","rmlock","e","tag","target","attrTagFilter","key","attributeName","val","getAttribute","disconnect","fn","addChildList","rmChildList","change"],"mappings":"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"}